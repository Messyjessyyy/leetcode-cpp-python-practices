class Solution:
    def maxSumTrionic(self, nums: List[int]) -> int:
        dp = [nums] + [[float("-inf")] * len(nums) for _ in range(3)]
        for i in range(1, len(nums)):
            for j in range(1, 4):
                if nums[i] > nums[i - 1] and j & 1 == 1 or nums[i] < nums[i - 1] and j & 1 == 0:
                    dp[j][i] = max(dp[j][i - 1], dp[j - 1][i - 1]) + nums[i]
        return max(dp[3])
